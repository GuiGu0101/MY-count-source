define("app/components/react-qtui/components/form/uploader",function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=e("node_modules/babel-runtime/helpers/defineProperty"),r=n(l),o=e("node_modules/babel-runtime/core-js/object/assign"),i=n(o),d=e("node_modules/babel-runtime/helpers/extends"),u=n(d),s=e("node_modules/babel-runtime/helpers/objectWithoutProperties"),c=n(s),f=e("node_modules/babel-runtime/core-js/object/get-prototype-of"),p=n(f),m=e("node_modules/babel-runtime/helpers/classCallCheck"),h=n(m),g=e("node_modules/babel-runtime/helpers/createClass"),v=n(g),_=e("node_modules/babel-runtime/helpers/possibleConstructorReturn"),C=n(_),b=e("node_modules/babel-runtime/helpers/inherits"),y=n(b),w=e("node_modules/react/react"),x=n(w),E=e("node_modules/prop-types/index"),k=n(E),q=e("node_modules/react-dom/index"),F=n(q),N=e("app/components/react-qtui/components/icon/index"),I=n(N),M=e("node_modules/classnames/index"),R=n(M),j=e("app/components/react-qtui/utils/deprecationWarning"),W=n(j),D=function(e){function t(){return h["default"](this,t),C["default"](this,(t.__proto__||p["default"](t)).apply(this,arguments))}return y["default"](t,e),v["default"](t,[{key:"detectVerticalSquash",value:function(e){var t=void 0,a=e.naturalHeight,n=document.createElement("canvas");n.width=1,n.height=a;var l=n.getContext("2d");l.drawImage(e,0,0);try{t=l.getImageData(0,0,1,a).data}catch(r){return console.log("Cannot check verticalSquash: CORS?"),1}for(var o=0,i=a,d=a;d>o;){var u=t[4*(d-1)+3];0===u?i=d:o=d,d=i+o>>1}var s=d/a;return 0===s?1:s}},{key:"handleFile",value:function(e,t){var a=this,n=arguments,l=void 0;"undefined"!=typeof FileReader?l=new FileReader:window.FileReader&&(l=new window.FileReader),l.onload=function(l){var r=void 0;"undefined"!=typeof Image?r=new Image:window.Image&&(r=new window.Image),r.onload=function(){var o=Math.min(a.props.maxWidth,r.width),i=r.height*(o/r.width),d=document.createElement("canvas"),u=d.getContext("2d");if(u){var s=u.drawImage;u.drawImage=function(e,t,l,r,o,i,d,c,f){var p=1;e&&"IMG"===e.nodeName&&(p=a.detectVerticalSquash(e),"undefined"==typeof r&&(r=e.naturalWidth),"undefined"==typeof o&&(o=e.naturalHeight)),9===n.length?s.call(u,e,t,l,r,o,i,d,c,f/p):"undefined"!=typeof r?s.call(u,e,t,l,r,o/p):s.call(u,e,t,l)},d.width=o,d.height=i,u.drawImage(r,0,0,o,i);var c=d.toDataURL("image/png");t({nativeFile:e,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,data:c},l)}else t(e,l)},r.src=l.target.result},l.readAsDataURL(e)}},{key:"handleChange",value:function(e){var t=this,a=this.props.lang,n=e.target.files;if(0!==n.length){if(this.props.files.length>=this.props.maxCount)return void this.props.onError(a.maxError(this.props.maxCount));for(var l in n)if(n.hasOwnProperty(l)){var r=n[l];this.handleFile(r,function(e,a){t.props.onChange&&t.props.onChange(e,a),F["default"].findDOMNode(t.refs.uploader).value=""},e)}}}},{key:"renderFiles",value:function(){var e=this;return this.props.files.map(function(t,a){var n=t.url,l=t.error,r=t.status,o=t.onClick,i=c["default"](t,["url","error","status","onClick"]),d={backgroundImage:"url("+n+")"},s=R["default"]({"qtui-uploader__file":!0,"qtui-uploader__file_status":l||r});o&&W["default"]("File onClick","Uploader onFileClick");var f=o?o:function(n){e.props.onFileClick&&e.props.onFileClick(n,t,a)};return x["default"].createElement("li",u["default"]({className:s,key:a,style:d,onClick:f},i),l||r?x["default"].createElement("div",{className:"qtui-uploader__file-content"},l?x["default"].createElement(I["default"],{value:"warn"}):r):!1)})}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.title,n=e.maxCount,l=e.files,o=(e.onChange,e.onFileClick,c["default"](e,["className","title","maxCount","files","onChange","onFileClick"])),d=i["default"]({},o);delete d.lang,delete d.onError,delete d.maxWidth;var s=R["default"](r["default"]({"qtui-uploader":!0},t,t));return x["default"].createElement("div",{className:s},x["default"].createElement("div",{className:"qtui-uploader__hd"},x["default"].createElement("p",{className:"qtui-uploader__title"},a),x["default"].createElement("div",{className:"qtui-uploader__info"},l.length,"/",n)),x["default"].createElement("div",{className:"qtui-uploader__bd"},x["default"].createElement("ul",{className:"qtui-uploader__files"},this.renderFiles()),x["default"].createElement("div",{className:"qtui-uploader__input-box"},x["default"].createElement("input",u["default"]({ref:"uploader",className:"qtui-uploader__input",type:"file",accept:"image/*",onChange:this.handleChange.bind(this)},d)))))}}]),t}(w.Component);D.propTypes={title:k["default"].string,maxCount:k["default"].number,maxWidth:k["default"].number,onChange:k["default"].func,onError:k["default"].func,files:k["default"].array,lang:k["default"].object},D.defaultProps={title:"图片上传",maxCount:4,maxWidth:500,files:[],onChange:void 0,onError:void 0,lang:{maxError:function(e){return"最多只能上传"+e+"张图片"}}},t["default"]=D,a.exports=t["default"]});